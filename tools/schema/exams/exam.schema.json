{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Exam Schema",
  "type": "object",
  "required": ["exam"],
  "properties": {
    "exam": {
      "type": "object",
      "required": [
        "title",
        "subject",
        "grade",
        "lesson_code",
        "duration",
        "questions"
      ],
      "properties": {
        "title": { "type": "string" },
        "subject": { "type": "string" },
        "grade": { "type": "integer", "minimum": 1, "maximum": 12 },
        "lesson_code": { "type": "string" },
        "duration": { "type": "integer", "minimum": 5 },
        "questions": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/definitions/question" }
        }
      },
      "additionalProperties": false
    }
  },

  "definitions": {
    "question": {
      "type": "object",
      "required": [
        "id",
        "type",
        "content",
        "difficulty",
        "score"
      ],
      "properties": {
        "id": { "type": "string" },

        "type": {
          "type": "string",
          "enum": ["mcq", "tfq", "shortAns", "essayq", "advanceessq"]
        },

        "content": { "type": "string" },

        "difficulty": {
          "type": "string",
          "enum": ["easy", "medium", "hard"]
        },

        "cognitive_level": {
          "type": "string",
          "enum": [
            "remember",
            "understand",
            "apply",
            "analyze",
            "evaluate"
          ]
        },

        "score": {
          "type": "number",
          "minimum": 0
        },

        "choices": {
          "type": "array",
          "minItems": 2,
          "items": { "$ref": "#/definitions/choice" }
        },

        "answer_key": {
          "type": ["string", "number", "boolean"]
        },

        "explanation": {
          "type": "string"
        },

        "rubric": {
          "type": "string"
        }
      },

      "allOf": [
        {
          "if": {
            "properties": {
              "type": { "enum": ["mcq", "tfq"] }
            }
          },
          "then": {
            "required": ["choices"],
            "not": {
              "required": ["rubric"]
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": { "enum": ["shortAns"] }
            }
          },
          "then": {
            "required": ["answer_key"],
            "not": {
              "required": ["choices"]
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": { "enum": ["essayq", "advanceessq"] }
            }
          },
          "then": {
            "required": ["rubric"],
            "not": {
              "required": ["choices"]
            }
          }
        }
      ],

      "additionalProperties": false
    },

    "choice": {
      "type": "object",
      "required": ["label", "content", "is_correct"],
      "properties": {
        "label": {
          "type": "string",
          "pattern": "^[A-Z]$|^(True|False)$"
        },
        "content": { "type": "string" },
        "is_correct": { "type": "boolean" }
      },
      "additionalProperties": false
    }
  }
}
